define(["jquery","jqueryui","local_dbreport/jquery-confirm","local_dbreport/chosen"],function(a){return{init:function(){function b(b){var c=b.serializeArray(),d={},e=[],f=[],g=[];return a.map(c,function(a,b){"planid"==a.name?e.push(a.value):"company"==a.name?f.push(a.value):"courseid"==a.name?g.push(a.value):d[a.name]=a.value}),d.username=a("#students_name_filter_chosen .chosen-search-input").val(),d.planid=e,d.company=f,d.courseid=g,d}function c(){a(".db-pager .chosen-select").chosen({width:"64px",disable_search:!0}),a("#wrapper-filter-form .chosen-select").chosen({width:"100%"})}function d(c){var d=b(a("form#filter-form"));console.log(d);var e=JSON.stringify(d);a.ajax({type:"POST",url:M.cfg.wwwroot+"/local/dbreport/rest.php?action=get_user_certification&data="+e,contentType:"application/json; charset=utf-8",dataType:"json",success:function(b){a("#students_name_filter").html(""),a("#students_name_filter").append('<option value="">All</option>'),a.each(b,function(b,c){a("#students_name_filter").append('<option value="'+c.id+'">'+c.name+"</option>")}),a("#students_name_filter").trigger("chosen:updated"),a("#students_name_filter_chosen .chosen-search-input").val(c)},error:function(a){console.log(a.d)}})}c(),a(document).on("change","#wrapper-filter-form .chosen-select",function(){var d=JSON.stringify(b(a("form#filter-form")));return a(".content-wrapper").append("<div class='db-loader'><div class='loader'>Loading...</div></div>"),a.ajax({url:M.cfg.wwwroot+"/local/dbreport/rest.php?action=get_certification_form&data="+d,success:function(b){a(".db-loader").remove(),a("#wrapper-filter-form").html(b),c(),a("#wrapper-filter-form .datepicker").datepicker()},error:function(a,b,c){console.log(b)}}),!1}),a(document).on("click","form#filter-form input[type=reset]",function(){return a(".content-wrapper").append('<div class="db-loader"><div class="loader">Loading...</div></div>'),a(".chosen-select").val("").trigger("chosen:updated"),a(":input","#filter-form").not(":button, :submit, :reset, :hidden").val("").removeAttr("checked").removeAttr("selected"),window.location.href="certificationreport.php?clear_filters=1",!1}),a(document).on("click","form#filter-form input[type=submit]",function(){var c=JSON.stringify(b(a("form#filter-form")));return a(".content-wrapper").append('<div class="db-loader"><div class="loader">Loading...</div></div>'),a.ajax({type:"GET",async:!0,url:M.cfg.wwwroot+"/local/dbreport/rest.php?action=get_data_certification_report&data="+c,success:function(b){console.log(b),a("#main-content").html(b),a(".db-loader").remove()},error:function(a,b,c){console.log(b)}}),!1}),a(document).on("click",".dbajax-click",function(){var b=a(this).attr("href");a(".db-loader").remove();var d=a(this),e=a(this).parent().find(".xcontent");return""===e.html().trim()?(a(".content-wrapper").append('<div class="db-loader"><div class="loader">Loading...</div></div>'),a.ajax({type:"GET",async:!0,url:b,success:function(b){a(".db-loader").remove(),e.html(b),d.addClass("db-open"),c()},error:function(a,b,c){console.log(b)}})):(d.removeClass("db-open"),e.html("")),!1}),a(document).on("click",".db-pager>a",function(){var b=a(this).attr("href"),d=a(this).closest(".xcontent");return a(".content-wrapper").append('<div class="db-loader"><div class="loader">Loading...</div></div>'),a.ajax({type:"GET",async:!0,url:b,success:function(b){console.log(b),a(".db-loader").remove(),d.html(b),c()},error:function(a,b,c){console.log(b)}}),!1}),a(document).on("change",".db-pager .chosen-select",function(){var b=a(this).children("option:selected").attr("value"),d=a(this).closest(".xcontent");return a(".content-wrapper").append('<div class="db-loader"><div class="loader">Loading...</div></div>'),a.ajax({type:"GET",async:!0,url:b,success:function(b){a(".db-loader").remove(),d.html(b),c()},error:function(a,b,c){console.log(b)}}),!1});a(document).on("keyup","#students_name_filter_chosen .chosen-search-input",function(){var b=a("#students_name_filter_chosen .chosen-search-input").val();a(this).val().length>2?d(b):(a("#students_name_filter").html("<option selected='selected' value=''>All</option>"),a("#students_name_filter").trigger("chosen:updated")),a("#students_name_filter_chosen .chosen-search-input").val(b)})}}});